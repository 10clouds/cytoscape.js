
/* cytoscape.layout.arbor.min.js */

/**
 * This file is part of cytoscape.js 2.0.2-github-snapshot-2013.09.02-09.14.40.
 * 
 * Cytoscape.js is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Cytoscape.js is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * cytoscape.js. If not, see <http://www.gnu.org/licenses/>.
 */
 
(function(a){var b={liveUpdate:true,ready:undefined,stop:undefined,maxSimulationTime:4000,fit:true,padding:[50,50,50,50],simulationBounds:undefined,ungrabifyWhileSimulating:true,repulsion:undefined,stiffness:undefined,friction:undefined,gravity:true,fps:undefined,precision:undefined,nodeMass:undefined,edgeLength:undefined,stepSize:1,stableEnergy:function(d){var f=d;return(f.max<=0.5)||(f.mean<=0.3)}};function c(d){this.options=a.util.extend({},b,d)}c.prototype.run=function(){var k=this.options;var j=k.cy;
var v=j.nodes();var i=j.edges();var p=j.container();var u=p.clientWidth;var r=p.clientHeight;var s=k.simulationBounds;if(k.simulationBounds){u=s[2]-s[0];r=s[3]-s[1]}else{k.simulationBounds=[0,0,u,r]}var x=k.simulationBounds;x.x1=x[0];x.y1=x[1];x.x2=x[2];x.y2=x[3];if(j.nodes().size()<=1){if(k.fit){j.reset()}j.nodes().position({x:Math.round((x.x1+x.x2)/2),y:Math.round((x.y1+x.y2)/2)});j.one("layoutstop",k.stop);j.trigger("layoutstop");j.one("layoutstop",k.stop);j.trigger("layoutstop");return}var m=this.system=arbor.ParticleSystem(k.repulsion,k.stiffness,k.friction,k.gravity,k.fps,k.dt,k.precision);
this.system=m;if(k.liveUpdate&&k.fit){j.reset()}var t=250;var h;var o=false;var g=+new Date;var q={init:function(y){},redraw:function(){var z=m.energy();if(k.stableEnergy!=null&&z!=null&&z.n>0&&k.stableEnergy(z)){m.stop();return}clearTimeout(h);h=setTimeout(w,t);var A=[];m.eachNode(function(G,B){var F=G.name;var D=G.data;var C=D.element;if(C==null){return}var E=C._private.position;if(!C.locked()&&!C.grabbed()){E.x=x.x1+B.x;E.y=x.y1+B.y;A.push(C)}});var y=(+new Date-g)>=16;if(k.liveUpdate&&A.length>0&&y){new a.Collection(j,A).rtrigger("position");
g=+new Date}if(!o){o=true;j.one("layoutready",k.ready);j.trigger("layoutready")}}};m.renderer=q;m.screenSize(u,r);m.screenPadding(k.padding[0],k.padding[1],k.padding[2],k.padding[3]);m.screenStep(k.stepSize);function n(y,z){if(z==null){return undefined}else{if(typeof z==typeof function(){}){return z.apply(y,[y._private.data,{nodes:v.length,edges:i.length,element:y}])}else{return z}}}function d(D){var G=D.x;var E=D.y;var H=u;var B=r;var A=-2;var I=2;var F=-2;var z=2;var C=4;return{x:G/H*C+A,y:E/B*C+I}
}var l=function(z){grabbed=this;var A=m.fromScreen(this.position());var y=arbor.Point(A.x,A.y);this.scratch().arbor.p=y;switch(z.type){case"grab":this.scratch().arbor.fixed=true;break;case"dragstop":this.scratch().arbor.fixed=false;this.scratch().arbor.tempMass=1000;break}};v.bind("grab drag dragstop",l);v.each(function(A,B){var D=this._private.data.id;var z=n(this,k.nodeMass);var y=this._private.locked;var C=d({x:B.position().x,y:B.position().y});if(B.locked()){return}this.scratch().arbor=m.addNode(D,{element:this,mass:z,fixed:y,x:y?C.x:undefined,y:y?C.y:undefined})
});i.each(function(){var B=this.id();var z=this.source().id();var A=this.target().id();var y=n(this,k.edgeLength);this.scratch().arbor=m.addEdge(z,A,{length:y})});function f(y){if(k.fit){j.fit()}y()}var e=v.filter(":grabbable");if(k.ungrabifyWhileSimulating){e.ungrabify()}var w=function(){if(window.isIE){f(function(){y()})}else{y()}function y(){if(!k.liveUpdate){if(k.fit){j.reset()}j.nodes().rtrigger("position")}v.unbind("grab drag dragstop",l);if(k.ungrabifyWhileSimulating){e.grabify()}j.one("layoutstop",k.stop);
j.trigger("layoutstop")}};m.start();setTimeout(function(){m.stop()},k.maxSimulationTime)};c.prototype.stop=function(){if(this.system!=null){system.stop()}};a("layout","arbor",c)})(cytoscape);